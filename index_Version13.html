<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ÙƒØªØ¨ ØªØ­ÙÙŠØ¸ Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø¨Ù† Ù…Ø­Ù…ÙˆØ¯ Ø£Ø¨Ùˆ Ù†ÙˆØ§Ø±Ø¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <!-- Google Fonts - Amiri Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:ital@0;1&display=swap" rel="stylesheet">
  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>
  <style>
    body, h1, h2, h3, h4, h5, h6, p, div, span, a, .main-title, .card, .greeting, .welcome-msg, .contact-section, .whatsapp-link, .fixed-footer {
      font-family: 'Amiri', serif !important;
    }
    body {
      background: linear-gradient(to bottom right, #f5efe6, #c0e6c9 70%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      direction: rtl;
      text-align: center;
    }
    .main-title {
      font-size: 2.0rem;
      font-weight: bold;
      color: #147a3d;
      margin-top: 32px;
      letter-spacing: 1px;
      line-height: 1.2;
      text-align: center;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px rgba(80, 180, 82, 0.10);
      margin-top: 22px;
      margin-bottom: 0;
      padding: 1rem;
      font-size: 1rem;
      direction: rtl;
      text-align: center;
    }
    .greeting {
      font-size: 1.3rem;
      color: #26ac68;
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
    }
    }
    .salgon {
      font-size: 1rem;
      color: #000000;
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
    }
    .welcome-msg {
      color: #000000;
      font-size: 1.1rem;
      margin-top: 10px;
      margin-bottom: 6px;
      line-height: 1.7;
      text-align: center;
    }
    .contact-section {
      font-size: 1rem;
      padding-top: 7px;
      padding-bottom: 7px;
      text-align: center;
      direction: rtl;
    }
    .whatsapp-link {
      font-weight: bold;
      color: #25d366;
      text-decoration: none;
      font-size: 1.03rem;
      direction: rtl;
    }
    .fixed-footer {
      position: fixed;
      width: 100vw;
      left: 0;
      bottom: 0;
      background: rgba(255,255,255,0.90);
      box-shadow: 0px -2px 10px rgba(80, 180, 82, 0.08);
      padding: 7px 0;
      z-index: 200;
      direction: rtl;
      text-align: center;
    }
    
    /* ========== PROFILE IMAGE STYLES ========== */
    .profile-image-container {
      position: fixed;
      top: 1.5rem;
      left: 1.5rem;
      z-index: 150;
      animation: slideIn 0.5s ease-out;
    }
    .profile-image {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      border: 3px solid #147a3d;
      box-shadow: 0 4px 15px rgba(20, 122, 61, 0.3), 0 0 20px rgba(20, 122, 61, 0.1);
      object-fit: cover;
      overflow: hidden;
      background: white;
      transition: all 0.3s ease;
    }
    .profile-image:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(20, 122, 61, 0.4), 0 0 30px rgba(20, 122, 61, 0.2);
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    /* ========== Login Page Styles ========== */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(to bottom right, #f5efe6, #c0e6c9 70%);
    }
    .login-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(80, 180, 82, 0.15);
      padding: 2rem;
      max-width: 400px;
      width: 100%;
    }
    .login-title {
      font-size: 1.8rem;
      color: #147a3d;
      margin-bottom: 1.5rem;
      font-weight: bold;
      text-align: center;
    }
    .form-group {
      margin-bottom: 1.5rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #333;
      font-weight: 500;
      text-align: right;
    }
    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: 'Amiri', serif !important;
      text-align: right;
      direction: rtl;
    }
    .form-control:focus {
      outline: none;
      border-color: #26ac68;
      box-shadow: 0 0 8px rgba(38, 172, 104, 0.2);
    }
    .btn {
      width: 100%;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-family: 'Amiri', serif !important;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-primary {
      background: #26ac68;
      color: white;
    }
    .btn-primary:hover {
      background: #147a3d;
    }
    .btn-secondary {
      background: #ddd;
      color: #333;
      margin-top: 0.5rem;
    }
    .btn-secondary:hover {
      background: #ccc;
    }
    .error-message {
      color: #d32f2f;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      text-align: center;
    }
    .success-message {
      color: #26ac68;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      text-align: center;
    }
    
    /* ========== Attendance Page Styles ========== */
    .attendance-container {
      background: linear-gradient(to bottom right, #f5efe6, #c0e6c9 70%);
      min-height: 100vh;
      padding: 2rem 1rem;
      padding-bottom: 150px;
    }
    .attendance-header {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 12px rgba(80, 180, 82, 0.10);
      text-align: center;
    }
    .attendance-title {
      font-size: 1.5rem;
      color: #147a3d;
      margin: 0;
      font-weight: bold;
    }
    .teacher-info {
      font-size: 0.95rem;
      color: #26ac68;
      margin-top: 0.5rem;
    }
    .student-form {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 12px rgba(80, 180, 82, 0.10);
    }
    .student-item {
      display: flex;
      justify-content: space-between;
      align-items: stretch;
      padding: 1rem;
      border: 1px solid #e0e0e0;
      background: white;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      transition: all 0.3s ease;
    }
    .student-item:hover {
      box-shadow: 0 2px 8px rgba(80, 180, 82, 0.15);
      border-color: #26ac68;
    }
    .student-item:last-child {
      margin-bottom: 0;
    }
    .student-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: right;
      padding-right: 1rem;
    }
    .student-name {
      font-size: 1.05rem;
      color: #147a3d;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    .student-notes-input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Amiri', serif !important;
      text-align: right;
      direction: rtl;
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }
    .status-buttons {
      display: flex;
      gap: 0.5rem;
      flex-direction: row-reverse;
    }
    .btn-small {
      padding: 0.75rem 1.2rem;
      font-size: 0.9rem;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      min-width: 90px;
    }
    .btn-present {
      background: #e8f5e9;
      color: #26ac68;
      border-color: #26ac68;
    }
    .btn-present:hover {
      background: #c8e6c9;
    }
    .btn-present.active {
      background: #26ac68;
      color: white;
      box-shadow: 0 0 12px rgba(38, 172, 104, 0.4);
    }
    .btn-absent {
      background: #ffebee;
      color: #f44336;
      border-color: #f44336;
    }
    .btn-absent:hover {
      background: #ffcdd2;
    }
    .btn-absent.active {
      background: #f44336;
      color: white;
      box-shadow: 0 0 12px rgba(244, 67, 54, 0.4);
    }
    .attendance-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      padding: 1rem;
      box-shadow: 0 -2px 10px rgba(80, 180, 82, 0.08);
      display: flex;
      gap: 0.5rem;
      z-index: 100;
    }
    .attendance-footer button {
      flex: 1;
      padding: 0.75rem;
      border: none;
      border-radius: 8px;
      font-family: 'Neirizi', serif !important;
      font-weight: bold;
      cursor: pointer;
    }
    
    @media (max-width: 767px) {
      .main-title {
        font-size: 1.2rem;
        margin-top: 20px;
      }
      .greeting {
        font-size: 1.0rem;
        margin-top: 9px;
      }
      .card {
        margin-top: 18px;
        padding: 0.8rem;
        font-size: 0.9rem;
      }
      .welcome-msg {
        font-size: 0.9rem;
      }
      .fixed-footer {
        font-size: 0.9rem;
        padding: 6px 0;
      }
      .contact-section, .whatsapp-link {
        font-size: 0.93rem;
      }
      .login-card {
        padding: 1.5rem;
      }
      .profile-image {
        width: 100px;
        height: 100px;
        top: 1rem;
        left: 1rem;
      }
      .profile-image-container {
        top: 1rem;
        left: 1rem;
      }
    }
    
    /* ========== Dashboard Styles ========== */
    .dashboard-container {
      background: linear-gradient(to bottom right, #f5efe6, #c0e6c9 70%);
      min-height: 100vh;
      padding: 2rem 1rem;
      padding-bottom: 80px;
    }
    .dashboard-header {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 12px rgba(80, 180, 82, 0.10);
      text-align: center;
    }
    .dashboard-title {
      font-size: 1.8rem;
      color: #147a3d;
      margin: 0;
      font-weight: bold;
    }
    .admin-info {
      font-size: 0.95rem;
      color: #26ac68;
      margin-top: 0.5rem;
    }
    .filter-section {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 12px rgba(80, 180, 82, 0.10);
      display: flex;
      gap: 1rem;
      align-items: flex-end;
      flex-wrap: wrap;
      justify-content: center;
    }
    .filter-group {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    .filter-group label {
      font-size: 0.9rem;
      color: #333;
      margin-bottom: 0.3rem;
      font-weight: 500;
    }
    .filter-group select,
    .filter-group input {
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Amiri', serif !important;
      text-align: right;
      direction: rtl;
    }
    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 12px rgba(80, 180, 82, 0.10);
      text-align: center;
    }
    .stat-label {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 0.5rem;
    }
    .stat-value {
      font-size: 2rem;
      color: #147a3d;
      font-weight: bold;
    }
    .records-table {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(80, 180, 82, 0.10);
    }
    .records-table table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }
    .records-table thead {
      background: #f5f5f5;
      border-bottom: 2px solid #ddd;
    }
    .records-table th {
      padding: 1rem;
      text-align: right;
      color: #147a3d;
      font-weight: 600;
    }
    .records-table td {
      padding: 0.8rem 1rem;
      border-bottom: 1px solid #eee;
      text-align: right;
    }
    .records-table tbody tr:hover {
      background: #f9f9f9;
    }
    .status-present {
      background: #26ac68;
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      display: inline-block;
    }
    .status-absent {
      background: #f44336;
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.8rem;
      display: inline-block;
    }
    .dashboard-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      padding: 1rem;
      box-shadow: 0 -2px 10px rgba(80, 180, 82, 0.08);
      display: flex;
      gap: 0.5rem;
      z-index: 100;
      justify-content: center;
    }
    .dashboard-footer button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-family: 'Amiri', serif !important;
      font-weight: bold;
      cursor: pointer;
    }
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #999;
    }
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <!-- ØµÙˆØ±Ø© Ø§Ù„Ø´ÙŠØ® Ø§Ù„Ù…Ù„Ù‡Ù… Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ø±ÙŠ -->
  <!-- Ù…Ù„Ø§Ø­Ø¸Ø©: Ø£Ø¶Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø¨Ø§Ø³Ù… "sheikh.jpg" Ø£Ùˆ "sheikh.png" ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ -->
  <div class="profile-image-container">
    <img src="sheikh.jpg" alt="Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø¨Ù† Ù…Ø­Ù…ÙˆØ¯ Ø£Ø¨Ùˆ Ù†ÙˆØ§Ø±Ø¬" class="profile-image" title="Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø¨Ù† Ù…Ø­Ù…ÙˆØ¯ Ø£Ø¨Ùˆ Ù†ÙˆØ§Ø±Ø¬" onerror="this.src='https://via.placeholder.com/100/1a5d3b/ffffff?text=%D8%A7%D9%84%D8%B4%D9%8A%D8%AE'">
  </div>
  
  <!-- ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="homePage" class="container-fluid px-2" dir="rtl">
    <div class="main-title mb-1">Ù…ÙƒØªØ¨ ØªØ­ÙÙŠØ¸ Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø¨Ù† Ù…Ø­Ù…ÙˆØ¯ Ø£Ø¨Ùˆ Ù†ÙˆØ§Ø±Ø¬</div>
    <div class="greeting mt-2">Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ â˜ºï¸</div>
    <div class="row justify-content-center m-0">
          <div class="greeting mt-2"></div>
          <div class="greeting mt-2"></div>
          <div class="greeting mt-2"></div>


<div class="salgon">Ù„ÙØ¹ÙÙ„ÙÙ‘ Ø¥ÙÙ„Ù‡Ù Ø§Ù„Ù’Ø¹ÙØ±Ù’Ø´Ù ÙŠÙØ§ Ø¥ÙØ®Ù’ÙˆÙØªÙÙŠ ÙŠÙÙ‚ÙÙŠ ... Ø¬ÙÙ…ÙØ§Ø¹ÙØªÙÙ†ÙØ§ ÙƒÙÙ„ÙÙ‘ Ø§Ù„Ù…ÙÙƒØ§ÙØ±ÙÙ‡Ù Ù‡ÙÙˆÙÙ‘Ù„ÙØ§
</div>
<div class="salgon"> 
ÙˆÙÙŠÙØ¬Ù’Ø¹ÙÙ„ÙÙ†ÙØ§ Ù…ÙÙ…ÙÙ‘Ù†Ù’ ÙŠÙÙƒÙÙˆÙ†Ù ÙƒÙØªØ§ÙØ¨ÙÙ‡Ù ... Ø´ÙÙÙÙŠØ¹Ù‹Ø§ Ù„ÙÙ‡ÙÙ…Ù’ Ø¥ÙØ°Ù’ Ù…ÙØ§ Ù†ÙØ³ÙÙˆÙ’Ù‡Ù ÙÙÙŠÙ…Ù’Ø­ÙÙ„ÙØ§
</div>

      <div class="col-12 col-sm-10 col-md-8 col-lg-7 px-1">
        <div class="card welcome-card my-3 shadow-sm">
          <div class="card-body p-0">
            <div class="welcome-msg mb-1">
                 Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ¥Ø¯Ø§Ø±Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…ÙƒØªØ¨  <br>
              Ø¨Ø´ÙƒÙ„ Ø±Ù‚Ù…ÙŠ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.
            </div>
            <button class="btn btn-primary mt-3" onclick="showLoginPage()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
            <button class="btn btn-primary mt-2" style="background: #3f51b5;" onclick="showAdminLoginPage()">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
  <div id="adminLoginPage" style="display: none;" class="login-container" dir="rtl">
    <div class="login-card">
      <h2 class="login-title">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
      <div class="form-group">
        <label for="adminPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:</label>
        <input type="password" id="adminPassword" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" autocomplete="off">
      </div>
      <button class="btn btn-primary" onclick="loginAdmin()">Ø¯Ø®ÙˆÙ„</button>
      <div id="adminLoginError" class="error-message"></div>
      <button class="btn btn-secondary" onclick="showHomePage()">Ø±Ø¬ÙˆØ¹</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginPage" style="display: none;" class="login-container" dir="rtl">
    <div class="login-card">
      <h2 class="login-title">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…</h2>
      <div class="form-group">
        <label for="teacherCode">ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
        <input type="text" id="teacherCode" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯Ùƒ" autocomplete="off">
      </div>
      <div class="form-group">
        <label for="teacherPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:</label>
        <input type="password" id="teacherPassword" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" autocomplete="off">
      </div>
      <button class="btn btn-primary" onclick="loginTeacher()">Ø¯Ø®ÙˆÙ„</button>
      <div id="loginError" class="error-message"></div>
      <button class="btn btn-secondary" onclick="showHomePage()">Ø±Ø¬ÙˆØ¹</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± -->
  <div id="attendancePage" style="display: none;" class="attendance-container" dir="rtl">
    <div class="attendance-header">
      <h2 class="attendance-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</h2>
      <div class="teacher-info">
        <span id="currentTeacherName"></span> - <span id="currentDate"></span>
      </div>
      <button class="btn-secondary" onclick="showManageStudentsModal()" style="background: #ff9800; color: white; margin-top: 0.5rem; padding: 0.5rem 1rem;">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ (ØªÙØ­Ù…Ù‘Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹) -->
    <div id="studentsList" class="student-form">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¨Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… -->
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¹ Ø§Ù„Ø«Ø§Ø¨ØªØ© -->
    <div class="attendance-footer">
      <button class="btn-primary" onclick="saveAttendanceRecords()" style="background: #26ac68; color: white;">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <button class="btn-secondary" onclick="logout()" style="background: #f44336; color: white;">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… -->
  <div id="manageStudentsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
    <div style="background: white; margin: 2rem auto; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%; direction: rtl;">
      <h3 style="text-align: right; color: #147a3d; margin-bottom: 1.5rem;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>

      <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ -->
      <div style="margin-bottom: 2rem;">
        <h5 style="color: #147a3d; margin-bottom: 1rem;">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h5>
        <div class="form-group">
          <label for="modalStudentName" style="display: block; text-align: right; margin-bottom: 0.5rem;">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
          <input type="text" id="modalStudentName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" style="margin-bottom: 0.5rem;">
          
          <label for="modalStudentId" style="display: block; text-align: right; margin-bottom: 0.5rem;">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© (ID):</label>
          <input type="text" id="modalStudentId" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" style="margin-bottom: 1rem;">
        </div>
        <button class="btn btn-primary" onclick="addStudentFromModal()" style="width: 100%; background: #26ac68; color: white; border: none; padding: 0.8rem; border-radius: 6px; cursor: pointer;">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
      </div>

      <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
      <div>
        <h5 style="color: #147a3d; margin-bottom: 1rem;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
        <div id="modalStudentsList" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 1rem;">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>

      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ -->
      <div style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: center;">
        <button class="btn btn-secondary" onclick="closeManageStudentsModal()" style="background: #f44336; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 6px; cursor: pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <!-- Footer Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙ‚Ø· -->
  <footer class="fixed-footer" id="mainFooter">
    <div class="container-fluid contact-section">
      <span class="me-1">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³  Ø¢Ø¨ ğŸ’¬ </span>
      <a class="whatsapp-link" href="https://wa.me/201060936428" target="_blank">
        01060936428
      </a>
    </div>
  </footer>

  <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† -->
  <div id="teacherStudentsPage" style="display: none;" class="dashboard-container" dir="rtl">
    <div class="dashboard-header">
      <h2 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h2>
      <div class="admin-info">
        Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø·Ù„Ø§Ø¨ ÙƒÙ„ Ù…Ø¹Ù„Ù…
      </div>
    </div>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¹Ù„Ù… -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…</h5>
      <select id="selectTeacher" class="form-control" onchange="loadTeacherStudentsForEdit()">
        <option value="">-- Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ø§Ù‹ --</option>
        <option value="eman">Ø¥ÙŠÙ…Ø§Ù† Ø§Ù„ØµØ¨Ø§Øº</option>
        <option value="samar">Ø³Ù…Ø± Ø§Ù„Ø´Ø§Ø¹Ø±</option>
      </select>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø¹Ù„Ù… -->
    <div class="student-form" id="addStudentFormContainer" style="display: none;">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h5>
      <div class="form-group">
        <label for="teacherStudentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
        <input type="text" id="teacherStudentName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" autocomplete="off">
      </div>
      <button class="btn btn-primary" onclick="addStudentToTeacher()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… -->
    <div class="student-form" id="teacherStudentsListContainer" style="display: none;">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
      <div id="teacherStudentsList" style="max-height: 400px; overflow-y: auto;">
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
      </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¹ -->
    <div class="dashboard-footer">
      <button class="btn-primary" style="background: #26ac68; color: white;" onclick="showDashboardPage()">Ø±Ø¬ÙˆØ¹</button>
      <button class="btn-secondary" style="background: #f44336; color: white;" onclick="logoutAdmin()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ -->
  <div id="studentsManagementPage" style="display: none;" class="dashboard-container" dir="rtl">
    <div class="dashboard-header">
      <h2 class="dashboard-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
      <div class="admin-info">
        Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ø·Ù„Ø§Ø¨
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h5>
      <div class="form-group">
        <label for="newStudentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
        <input type="text" id="newStudentName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" autocomplete="off">
      </div>
      <div class="form-group">
        <label for="newStudentClass">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</label>
        <select id="newStudentClass" class="form-control">
          <option value="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„</option>
          <option value="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
          <option value="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ø§Ù„Ø«</option>
          <option value="Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="addNewStudent()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h5>
      <div id="studentsList" style="max-height: 400px; overflow-y: auto;">
        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
      </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¹ -->
    <div class="dashboard-footer">
      <button class="btn-primary" style="background: #26ac68; color: white;" onclick="showDashboardPage()">Ø±Ø¬ÙˆØ¹</button>
      <button class="btn-secondary" style="background: #f44336; color: white;" onclick="logoutAdmin()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† -->
  <div id="teacherReportsPage" style="display: none;" class="dashboard-container" dir="rtl">
    <div class="dashboard-header">
      <h2 class="dashboard-title">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</h2>
      <div class="admin-info">
        ØªÙ‚Ø§Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠØ© ÙˆØ¯ÙˆØ±ÙŠØ© Ù„ÙƒÙ„ Ù…Ø¹Ù„Ù…
      </div>
    </div>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¹Ù„Ù… -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ù„Ù…</h5>
      <select id="selectTeacherForReport" class="form-control">
        <option value="">-- Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ø§Ù‹ --</option>
        <option value="eman">Ø¥ÙŠÙ…Ø§Ù† Ø§Ù„ØµØ¨Ø§Øº</option>
        <option value="samar">Ø³Ù…Ø± Ø§Ù„Ø´Ø§Ø¹Ø±</option>
      </select>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h5>
      <p style="text-align: right; color: #666; font-size: 0.9rem;">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± Ø¨Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ù„Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±</p>
      <button class="btn btn-primary" style="background: #4CAF50;" onclick="exportDailyTeacherReport()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">ğŸ“… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h5>
      <p style="text-align: right; color: #666; font-size: 0.9rem;">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ø®Øµ Ù„Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…</p>
      <button class="btn btn-primary" style="background: #2196F3;" onclick="exportWeeklyTeacherReport()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù… -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…</h5>
      <div id="teacherStatsContainer">
        <p style="text-align: center; color: #999;">Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
      </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¹ -->
    <div class="dashboard-footer">
      <button class="btn-primary" style="background: #26ac68; color: white;" onclick="showDashboardPage()">Ø±Ø¬ÙˆØ¹</button>
      <button class="btn-secondary" style="background: #f44336; color: white;" onclick="logoutAdmin()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
  <div id="backupReportsPage" style="display: none;" class="dashboard-container" dir="rtl">
    <div class="dashboard-header">
      <h2 class="dashboard-title">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
      <div class="admin-info">
        Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">ğŸ” Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h5>
      <p style="text-align: right; color: #666; font-size: 0.9rem;">Ø§Ø­ÙØ¸ Ù†Ø³Ø®Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù† ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
      <button class="btn btn-primary" style="background: #4CAF50;" onclick="createAndDownloadBackup()">Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
      <div style="margin-top: 1rem; padding: 1rem; background: #f5f5f5; border-radius: 8px; text-align: right;">
        <label for="backupFile" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:</label>
        <input type="file" id="backupFile" accept=".json" style="width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid #ddd;">
        <button class="btn btn-primary" style="background: #2196F3; margin-top: 0.5rem;" onclick="restoreFromBackup()">Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ© -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h5>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
        <div>
          <label for="reportYear" style="display: block; margin-bottom: 0.3rem; font-size: 0.9rem;">Ø§Ù„Ø³Ù†Ø©:</label>
          <select id="reportYear" class="form-control">
            <option value="2025">2025</option>
            <option value="2024">2024</option>
          </select>
        </div>
        <div>
          <label for="reportMonth" style="display: block; margin-bottom: 0.3rem; font-size: 0.9rem;">Ø§Ù„Ø´Ù‡Ø±:</label>
          <select id="reportMonth" class="form-control">
            <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
            <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
            <option value="3">Ù…Ø§Ø±Ø³</option>
            <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
            <option value="5">Ù…Ø§ÙŠÙˆ</option>
            <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
            <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
            <option value="8">Ø£ØºØ³Ø·Ø³</option>
            <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
            <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
            <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
            <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
          </select>
        </div>
      </div>
      <button class="btn btn-primary" style="background: #FF9800;" onclick="generateAndExportMonthlyReport()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ</button>
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
    <div class="student-form">
      <h5 style="color: #147a3d; margin-bottom: 1rem; text-align: right;">ğŸ“§ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h5>
      <div class="form-group">
        <label for="adminEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
        <input type="email" id="adminEmail" class="form-control" placeholder="your@email.com" value="admin@saadquran.com">
      </div>
      <p style="text-align: right; color: #999; font-size: 0.85rem;">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ Ø¨Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
      <button class="btn btn-primary" style="background: #3f51b5;" onclick="sendDailyEmailReport()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¹ -->
    <div class="dashboard-footer">
      <button class="btn-primary" style="background: #26ac68; color: white;" onclick="showDashboardPage()">Ø±Ø¬ÙˆØ¹</button>
      <button class="btn-secondary" style="background: #f44336; color: white;" onclick="logoutAdmin()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© (Dashboard) -->
  <div id="dashboardPage" style="display: none;" class="dashboard-container" dir="rtl">
    <div class="dashboard-header">
      <h2 class="dashboard-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</h2>
      <div class="admin-info">
        ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…: <span id="adminDate"></span>
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ØªØµÙÙŠØ© -->
    <div class="filter-section">
      <button class="btn btn-primary" style="padding: 0.5rem 1.5rem; margin-top: 1.5rem;" onclick="refreshDashboard()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <div class="filter-group">
        <label for="filterTeacher">Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
        <select id="filterTeacher" onchange="refreshDashboard()">
          <option value="">Ø§Ù„ÙƒÙ„</option>
          <option value="eman">Ø¥ÙŠÙ…Ø§Ù†</option>
          <option value="samar">Ø³Ù…Ø±</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="filterDate">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" id="filterDate" onchange="refreshDashboard()">
      </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="stats-section" id="statsSection">
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª -->
    <div class="records-table">
      <table id="recordsTable">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„Ù…Ø¹Ù„Ù…</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          </tr>
        </thead>
        <tbody id="recordsBody">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </tbody>
      </table>
      <div id="emptyState" class="empty-state">
        <div class="empty-state-icon">ğŸ“‹</div>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„ØªØ¹Ø±Ø¶Ù‡Ø§</p>
      </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¹ Ø§Ù„Ø«Ø§Ø¨ØªØ© -->
    <div class="dashboard-footer">
      <button class="btn-primary" style="background: #26ac68; color: white;" onclick="exportToCSV_Dashboard()">ØªØ­Ù…ÙŠÙ„ CSV</button>
      <button class="btn-primary" style="background: #9C27B0; color: white;" onclick="showTeacherStudentsPage()">ğŸ‘¥ Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
      <button class="btn-primary" style="background: #FF5722; color: white;" onclick="showTeacherReportsPage()">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>
      <button class="btn-primary" style="background: #2196F3; color: white;" onclick="showStudentsManagementPage()">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
      <button class="btn-primary" style="background: #FF9800; color: white;" onclick="showBackupReportsPage()">Ø§Ù„Ù†Ø³Ø® ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
      <button class="btn-secondary" style="background: #f44336; color: white;" onclick="logoutAdmin()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- Firebase Config -->
  <script src="firebase-config.js"></script>
  <script>
    let currentTeacher = null;
    let attendanceData = {};

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    function showHomePage() {
      document.getElementById('homePage').style.display = 'block';
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('adminLoginPage').style.display = 'none';
      document.getElementById('attendancePage').style.display = 'none';
      document.getElementById('dashboardPage').style.display = 'none';
      document.getElementById('mainFooter').style.display = 'block';
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙˆØ±Ø© ÙÙ‚Ø· ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      document.querySelector('.profile-image-container').style.display = 'block';
    }

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
    function showAdminLoginPage() {
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('adminLoginPage').style.display = 'flex';
      document.getElementById('attendancePage').style.display = 'none';
      document.getElementById('dashboardPage').style.display = 'none';
      document.getElementById('mainFooter').style.display = 'none';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      document.getElementById('adminPassword').focus();
    }

    // Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function loginAdmin() {
      const password = document.getElementById('adminPassword').value.trim();
      const errorDiv = document.getElementById('adminLoginError');
      errorDiv.textContent = '';

      const adminPassword = 'admin2025'; // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§

      if (!password) {
        errorDiv.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±';
        return;
      }

      if (password === adminPassword) {
        document.getElementById('adminPassword').value = '';
        showDashboardPage();
      } else {
        errorDiv.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
      }
    }

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
    function showLoginPage() {
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'flex';
      document.getElementById('attendancePage').style.display = 'none';
      document.getElementById('mainFooter').style.display = 'none';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      document.getElementById('teacherCode').focus();
    }

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
    function showAttendancePage() {
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('attendancePage').style.display = 'block';
      document.getElementById('mainFooter').style.display = 'none';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      updateDateDisplay();
      loadTeacherStudents();
    }

    // Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…
    async function loginTeacher() {
      const code = document.getElementById('teacherCode').value.trim();
      const password = document.getElementById('teacherPassword').value.trim();
      const errorDiv = document.getElementById('loginError');
      errorDiv.textContent = '';

      if (!code) {
        errorDiv.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯';
        return;
      }

      if (!password) {
        errorDiv.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±';
        return;
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù… Ù…Ù† Firebase Ù…Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
      const teacher = await authenticateTeacher(code, password);
      
      if (teacher) {
        currentTeacher = teacher;
        attendanceData = {};
        document.getElementById('currentTeacherName').textContent = teacher.name || teacher.code;
        showAttendancePage();
      } else {
        errorDiv.textContent = 'Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
      }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    function loadTeacherStudents() {
      if (!currentTeacher) {
        return;
      }

      // Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
      attendanceData = {};

      // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… Ù…Ù† teachersDB
      const teacher = teachersDB[currentTeacher.code];
      if (teacher && teacher.students && teacher.students.length > 0) {
        teacher.students.forEach(student => {
          attendanceData[student.name] = { status: null, notes: '', id: student.id };
        });
      }

      renderStudentsList();
    }

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
    function updateStudentStatus(name, status) {
      if (attendanceData[name]) {
        attendanceData[name].status = attendanceData[name].status === status ? null : status;
        renderStudentsList();
      }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    function updateStudentNotes(name, notes) {
      if (attendanceData[name]) {
        attendanceData[name].notes = notes;
      }
    }

    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ø­Ø³Ù‘Ù†Ø©
    function renderStudentsList() {
      const listDiv = document.getElementById('studentsList');
      
      if (Object.keys(attendanceData).length === 0) {
        listDiv.innerHTML = '<div style="text-align: center; padding: 2rem; color: #999;"><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø¹ÙŠÙ†Ø© Ù„Ù„Ù…Ø¹Ù„Ù…</p></div>';
        return;
      }

      let html = '';
      const studentNames = Object.keys(attendanceData);
      
      studentNames.forEach((name, index) => {
        const data = attendanceData[name];
        const presentActive = data.status === 'present' ? 'active' : '';
        const absentActive = data.status === 'absent' ? 'active' : '';
        
        html += `
          <div class="student-item">
            <div class="student-info">
              <div class="student-name">ğŸ“š ${name}</div>
              <input type="text" class="student-notes-input" 
                     placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" 
                     onchange="updateStudentNotes('${name}', this.value)"
                     value="${data.notes || ''}">
            </div>
            <div class="status-buttons">
              <button class="btn-small btn-absent ${absentActive}" 
                      onclick="updateStudentStatus('${name}', 'absent')">âœ— ØºØ§Ø¦Ø¨</button>
              <button class="btn-small btn-present ${presentActive}" 
                      onclick="updateStudentStatus('${name}', 'present')">âœ“ Ø­Ø§Ø¶Ø±</button>
            </div>
          </div>
        `;
      });
      
      listDiv.innerHTML = html;
    }

    // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
    async function saveAttendanceRecords() {
      if (Object.keys(attendanceData).length === 0) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
      }

      let hasUnsaved = false;
      for (const [name, data] of Object.entries(attendanceData)) {
        if (!data.status) {
          hasUnsaved = true;
          break;
        }
      }

      if (hasUnsaved) {
        if (!confirm('Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø§Ø¨ Ù„Ù… ØªØ­Ø¯Ø¯ Ø­Ø§Ù„ØªÙ‡Ù…. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„ØŸ')) {
          return;
        }
      }

      // Ø­ÙØ¸ ÙƒÙ„ Ø³Ø¬Ù„ ÙÙŠ Firebase
      for (const [name, data] of Object.entries(attendanceData)) {
        if (data.status) {
          await saveAttendance(currentTeacher.code, name, data.status, data.notes);
        }
      }

      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ“');
      logout();
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
    function updateDateDisplay() {
      const today = new Date();
      const dateStr = today.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      document.getElementById('currentDate').textContent = dateStr;
    }
    // ========== Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ==========
    
    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
    function showManageStudentsModal() {
      if (!currentTeacher) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }
      
      document.getElementById('manageStudentsModal').style.display = 'block';
      renderModalStudentsList();
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
    function closeManageStudentsModal() {
      document.getElementById('manageStudentsModal').style.display = 'none';
      document.getElementById('modalStudentName').value = '';
      document.getElementById('modalStudentId').value = '';
    }

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    function addStudentFromModal() {
      if (!currentTeacher) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }

      const studentName = document.getElementById('modalStudentName').value.trim();
      const studentId = document.getElementById('modalStudentId').value.trim();

      if (!studentName) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
        return;
      }

      if (!studentId) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©');
        return;
      }

      const teacher = teachersDB[currentTeacher.code];
      
      // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹
      if (teacher.students.some(s => s.name === studentName)) {
        alert('Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù†Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…');
        return;
      }

      // Ø£Ø¶Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      const newStudent = {
        id: studentId,
        name: studentName
      };

      teacher.students.push(newStudent);
      alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
      
      // Ø§Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      document.getElementById('modalStudentName').value = '';
      document.getElementById('modalStudentId').value = '';
      
      // Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ ÙƒÙ„ Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙˆØµÙØ­Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
      renderModalStudentsList();
      loadTeacherStudents();
    }

    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    function renderModalStudentsList() {
      if (!currentTeacher) return;

      const teacher = teachersDB[currentTeacher.code];
      const container = document.getElementById('modalStudentsList');

      if (!teacher || !teacher.students || teacher.students.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø¨Ø¹Ø¯</p>';
        return;
      }

      let html = '';
      teacher.students.forEach(student => {
        html += `
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; border-bottom: 1px solid #eee; direction: rtl;">
            <div style="flex: 1; text-align: right;">
              <div style="font-weight: bold; color: #147a3d;">ğŸ“š ${student.name}</div>
              <div style="font-size: 0.85rem; color: #666;">ğŸ†” ${student.id}</div>
            </div>
            <button style="background: #f44336; color: white; border: none; padding: 0.5rem 0.8rem; border-radius: 4px; cursor: pointer;" onclick="deleteStudentFromModal('${student.id}', '${student.name}')">ğŸ—‘ Ø­Ø°Ù</button>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Ø­Ø°Ù Ø·Ø§Ù„Ø¨ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function deleteStudentFromModal(studentId, studentName) {
      if (!currentTeacher) return;
      
      if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ "${studentName}"ØŸ`)) {
        const teacher = teachersDB[currentTeacher.code];
        teacher.students = teacher.students.filter(s => s.id !== studentId);
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
        
        // Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        renderModalStudentsList();
        loadTeacherStudents();
      }
    }

    // Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø¹Ù„Ù…
    function logout() {
      currentTeacher = null;
      attendanceData = {};
      document.getElementById('teacherCode').value = '';
      document.getElementById('loginError').textContent = '';
      showHomePage();
    }

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…ÙØªØ§Ø­ Enter ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('teacherCode').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          document.getElementById('teacherPassword').focus();
        }
      });

      document.getElementById('teacherPassword').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          loginTeacher();
        }
      });

      document.getElementById('adminPassword').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          loginAdmin();
        }
      });

      document.getElementById('studentNameInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          addStudentForm();
        }
      });

      // Ø¶Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„ØªØµÙÙŠØ©
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('filterDate').value = today;

      showHomePage();
    });

    // ========== Ø¯ÙˆØ§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ==========

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    function showDashboardPage() {
      document.getElementById('homePage').style.display = 'none';
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('attendancePage').style.display = 'none';
      document.getElementById('dashboardPage').style.display = 'block';
      document.getElementById('mainFooter').style.display = 'none';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      
      updateAdminDateDisplay();
      refreshDashboard();
    }

    // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function updateAdminDateDisplay() {
      const today = new Date();
      const dateStr = today.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      document.getElementById('adminDate').textContent = dateStr;
    }

    // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function refreshDashboard() {
      const filterTeacher = document.getElementById('filterTeacher').value;
      const filterDate = document.getElementById('filterDate').value;

      // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† localStorage
      let allRecords = [];
      for (let key in localStorage) {
        if (key.startsWith('attendance_')) {
          const record = JSON.parse(localStorage[key]);
          allRecords.push(record);
        }
      }

      // Ø·Ø¨Ù‘Ù‚ Ø§Ù„ØªØµÙÙŠØ©
      let filteredRecords = allRecords;
      
      if (filterTeacher) {
        filteredRecords = filteredRecords.filter(r => r.teacherCode === filterTeacher);
      }
      
      if (filterDate) {
        filteredRecords = filteredRecords.filter(r => r.date === filterDate);
      }

      // Ø±ØªØ¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…Ø¹Ù„Ù…
      filteredRecords.sort((a, b) => {
        if (a.date !== b.date) {
          return new Date(b.date) - new Date(a.date);
        }
        return a.teacherCode.localeCompare(b.teacherCode);
      });

      // Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      const presentCount = filteredRecords.filter(r => r.status === 'present').length;
      const absentCount = filteredRecords.filter(r => r.status === 'absent').length;
      const totalCount = filteredRecords.length;

      // Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      displayStats(presentCount, absentCount, totalCount);

      // Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
      displayRecordsTable(filteredRecords);
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function displayStats(present, absent, total) {
      const statsSection = document.getElementById('statsSection');
      statsSection.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
          <div class="stat-value">${total}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Ø­Ø§Ø¶Ø±ÙˆÙ†</div>
          <div class="stat-value" style="color: #26ac68;">${present}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ØºØ§Ø¦Ø¨ÙˆÙ†</div>
          <div class="stat-value" style="color: #f44336;">${absent}</div>
        </div>
      `;
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
    function displayRecordsTable(records) {
      const tbody = document.getElementById('recordsBody');
      const emptyState = document.getElementById('emptyState');
      const table = document.querySelector('.records-table table');

      if (records.length === 0) {
        table.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      table.style.display = 'table';
      emptyState.style.display = 'none';

      tbody.innerHTML = records.map(record => {
        const statusHTML = record.status === 'present' 
          ? `<span class="status-present">âœ“ Ø­Ø§Ø¶Ø±</span>` 
          : `<span class="status-absent">âœ— ØºØ§Ø¦Ø¨</span>`;
        
        const dateFormatted = new Date(record.date).toLocaleDateString('ar-EG');
        
        // Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…
        const teacherName = teachersDB[record.teacherCode]?.name || record.teacherCode;

        return `
          <tr>
            <td>${dateFormatted}</td>
            <td>${teacherName}</td>
            <td>${record.studentName}</td>
            <td>${statusHTML}</td>
            <td>${record.notes || '-'}</td>
          </tr>
        `;
      }).join('');
    }

    // Ø¯Ø§Ù„Ø© Ù„ØªØµØ¯ÙŠØ± CSV Ù…Ù† Dashboard
    function exportToCSV_Dashboard() {
      const filterTeacher = document.getElementById('filterTeacher').value;
      const filterDate = document.getElementById('filterDate').value;

      let allRecords = [];
      for (let key in localStorage) {
        if (key.startsWith('attendance_')) {
          const record = JSON.parse(localStorage[key]);
          allRecords.push(record);
        }
      }

      // Ø·Ø¨Ù‘Ù‚ Ø§Ù„ØªØµÙÙŠØ©
      let filteredRecords = allRecords;
      
      if (filterTeacher) {
        filteredRecords = filteredRecords.filter(r => r.teacherCode === filterTeacher);
      }
      
      if (filterDate) {
        filteredRecords = filteredRecords.filter(r => r.date === filterDate);
      }

      if (filteredRecords.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
        return;
      }

      let csv = 'Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ù…Ø¹Ù„Ù…,Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
      
      filteredRecords.forEach(record => {
        const dateFormatted = new Date(record.date).toLocaleDateString('ar-EG');
        const teacherName = teachersDB[record.teacherCode]?.name || record.teacherCode;
        const status = record.status === 'present' ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨';
        
        csv += `${dateFormatted},${teacherName},${record.studentName},${status},"${record.notes}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `attendance_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function logoutAdmin() {
      showHomePage();
    }

    // ========== ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… localStorage ==========
    async function saveAttendanceRecords() {
      if (Object.keys(attendanceData).length === 0) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
      }

      let hasUnsaved = false;
      for (const [name, data] of Object.entries(attendanceData)) {
        if (!data.status) {
          hasUnsaved = true;
          break;
        }
      }

      if (hasUnsaved) {
        if (!confirm('Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø§Ø¨ Ù„Ù… ØªØ­Ø¯Ø¯ Ø­Ø§Ù„ØªÙ‡Ù…. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„ØŸ')) {
          return;
        }
      }

      // Ø­ÙØ¸ ÙƒÙ„ Ø³Ø¬Ù„ ÙÙŠ localStorage
      const today = new Date().toISOString().split('T')[0];
      for (const [name, data] of Object.entries(attendanceData)) {
        if (data.status) {
          const recordId = `attendance_${Date.now()}_${Math.random()}`;
          const record = {
            id: recordId,
            teacherCode: currentTeacher.code,
            studentName: name,
            status: data.status,
            notes: data.notes,
            date: today,
            timestamp: new Date().toISOString()
          };
          localStorage.setItem(recordId, JSON.stringify(record));
        }
      }

      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ“');
      logout();
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ==========

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
    function showStudentsManagementPage() {
      document.getElementById('dashboardPage').style.display = 'none';
      document.getElementById('backupReportsPage').style.display = 'none';
      document.getElementById('studentsManagementPage').style.display = 'block';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      renderStudentsList_Admin();
    }

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
    function addNewStudent() {
      const nameInput = document.getElementById('newStudentName');
      const classSelect = document.getElementById('newStudentClass');
      
      const name = nameInput.value.trim();
      const classLevel = classSelect.value;

      if (!name) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
        return;
      }

      addStudent(name, classLevel);
      alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
      nameInput.value = '';
      renderStudentsList_Admin();
    }

    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    function renderStudentsList_Admin() {
      const students = getAllStudents();
      const container = document.getElementById('studentsList');

      if (students.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø¨Ø¹Ø¯</p>';
        return;
      }

      let html = '';
      students.forEach(student => {
        html += `
          <div class="student-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 0.5rem;">
            <div style="flex: 1; text-align: right;">
              <div class="student-name">${student.name}</div>
              <div style="font-size: 0.85rem; color: #666; margin-top: 0.3rem;">${student.class}</div>
            </div>
            <div class="status-buttons" style="gap: 0.5rem;">
              <button class="btn-small" style="background: #2196F3; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer;" onclick="editStudent('${student.id}')">âœ ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="btn-small" style="background: #f44336; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer;" onclick="deleteStudentConfirm('${student.id}', '${student.name}')">ğŸ—‘ Ø­Ø°Ù</button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Ø­Ø°Ù Ø·Ø§Ù„Ø¨ Ù…Ø¹ ØªØ£ÙƒÙŠØ¯
    function deleteStudentConfirm(studentId, studentName) {
      if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨: ${studentName}ØŸ`)) {
        deleteStudent(studentId);
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
        renderStudentsList_Admin();
      }
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø·Ø§Ù„Ø¨ (Ù…Ø­Ø§ÙƒØ§Ø©)
    function editStudent(studentId) {
      const students = getAllStudents();
      const student = students.find(s => s.id === studentId);
      
      if (student) {
        const newName = prompt('Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', student.name);
        if (newName && newName.trim()) {
          updateStudent(studentId, newName.trim(), student.class);
          alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
          renderStudentsList_Admin();
        }
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ==========

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    function showBackupReportsPage() {
      document.getElementById('dashboardPage').style.display = 'none';
      document.getElementById('studentsManagementPage').style.display = 'none';
      document.getElementById('backupReportsPage').style.display = 'block';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      
      // Ø¶Ø¹ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      const today = new Date();
      document.getElementById('reportMonth').value = today.getMonth() + 1;
      document.getElementById('reportYear').value = today.getFullYear();
    }

    // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    function createAndDownloadBackup() {
      const backup = createBackup();
      alert(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
      - ${Object.keys(teachersDB).length} Ù…Ø¹Ù„Ù…
      - ${getAllStudents().length} Ø·Ø§Ù„Ø¨
      - Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${backup.attendance.length}`);
    }

    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    function restoreFromBackup() {
      const fileInput = document.getElementById('backupFile');
      const file = fileInput.files[0];

      if (!file) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const backupData = JSON.parse(e.target.result);
          const result = restoreBackup(backupData);
          alert(result.message);
          if (result.success) {
            fileInput.value = '';
          }
        } catch (error) {
          alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
        }
      };
      reader.readAsText(file);
    }

    // ØªÙˆÙ„ÙŠØ¯ ÙˆØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
    function generateAndExportMonthlyReport() {
      const year = parseInt(document.getElementById('reportYear').value);
      const month = parseInt(document.getElementById('reportMonth').value);

      const report = generateMonthlyReport(year, month);
      
      if (report.records.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±');
        return;
      }

      // ØªÙˆÙ„ÙŠØ¯ CSV
      let csv = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ\n';
      csv += `Ø§Ù„Ø³Ù†Ø©: ${year}, Ø§Ù„Ø´Ù‡Ø±: ${month}\n\n`;
      csv += 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©:\n';
      csv += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª,${report.statistics.totalRecords}\n`;
      csv += `Ø­Ø§Ø¶Ø±ÙˆÙ†,${report.statistics.presentCount}\n`;
      csv += `ØºØ§Ø¦Ø¨ÙˆÙ†,${report.statistics.absentCount}\n\n`;
      
      csv += 'Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ù…Ø¹Ù„Ù…,Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
      
      report.records.forEach(record => {
        const dateFormatted = new Date(record.date).toLocaleDateString('ar-EG');
        const teacherName = teachersDB[record.teacherCode]?.name || record.teacherCode;
        const status = record.status === 'present' ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨';
        
        csv += `${dateFormatted},${teacherName},${record.studentName},${status},"${record.notes}"\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `monthly_report_${year}_${month}.csv`;
      link.click();

      alert(`ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø¨Ù†Ø¬Ø§Ø­!\nØ¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${report.records.length}`);
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯
    function sendDailyEmailReport() {
      const email = document.getElementById('adminEmail').value.trim();

      if (!email) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
        return;
      }

      if (!email.includes('@')) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
        return;
      }

      const result = sendDailyReport(email);
      alert(result.message);
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ==========

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†
    function showTeacherStudentsPage() {
      document.getElementById('dashboardPage').style.display = 'none';
      document.getElementById('studentsManagementPage').style.display = 'none';
      document.getElementById('backupReportsPage').style.display = 'none';
      document.getElementById('teacherStudentsPage').style.display = 'block';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      document.getElementById('selectTeacher').value = '';
      document.getElementById('addStudentFormContainer').style.display = 'none';
      document.getElementById('teacherStudentsListContainer').style.display = 'none';
    }

    // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±
    function loadTeacherStudentsForEdit() {
      const teacherCode = document.getElementById('selectTeacher').value;

      if (!teacherCode) {
        document.getElementById('addStudentFormContainer').style.display = 'none';
        document.getElementById('teacherStudentsListContainer').style.display = 'none';
        return;
      }

      const teacher = teachersDB[teacherCode];
      if (!teacher) {
        alert('Ø§Ù„Ù…Ø¹Ù„Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        return;
      }

      document.getElementById('addStudentFormContainer').style.display = 'block';
      document.getElementById('teacherStudentsListContainer').style.display = 'block';
      
      renderTeacherStudentsList(teacherCode);
    }

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ù„Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±
    function addStudentToTeacher() {
      const teacherCode = document.getElementById('selectTeacher').value;
      const studentName = document.getElementById('teacherStudentName').value.trim();

      if (!teacherCode) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ù„Ù…Ø§Ù‹');
        return;
      }

      if (!studentName) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
        return;
      }

      const teacher = teachersDB[teacherCode];
      
      // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø³Ø¨Ù‚Ø§Ù‹
      if (teacher.students.some(s => s.name === studentName)) {
        alert('Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¹Ù†Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…');
        return;
      }

      // Ø£Ø¶Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
      const newStudent = {
        id: Date.now().toString(),
        name: studentName
      };

      teacher.students.push(newStudent);
      alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
      document.getElementById('teacherStudentName').value = '';
      renderTeacherStudentsList(teacherCode);
    }

    // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…
    function renderTeacherStudentsList(teacherCode) {
      const teacher = teachersDB[teacherCode];
      const container = document.getElementById('teacherStudentsList');

      if (!teacher || !teacher.students || teacher.students.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø¨Ø¹Ø¯</p>';
        return;
      }

      let html = '';
      teacher.students.forEach(student => {
        html += `
          <div class="student-item" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 0.5rem;">
            <div style="flex: 1; text-align: right;">
              <div class="student-name">ğŸ“š ${student.name}</div>
            </div>
            <div class="status-buttons" style="gap: 0.5rem;">
              <button class="btn-small" style="background: #f44336; color: white; padding: 0.5rem 0.8rem; border: none; border-radius: 6px; cursor: pointer;" onclick="deleteTeacherStudent('${teacherCode}', '${student.id}', '${student.name}')">ğŸ—‘ Ø­Ø°Ù</button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Ø­Ø°Ù Ø·Ø§Ù„Ø¨ Ù…Ù† Ù…Ø¹Ù„Ù…
    function deleteTeacherStudent(teacherCode, studentId, studentName) {
      if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ "${studentName}" Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù…ØŸ`)) {
        const teacher = teachersDB[teacherCode];
        teacher.students = teacher.students.filter(s => s.id !== studentId);
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ“');
        renderTeacherStudentsList(teacherCode);
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ Ù…Ø¹Ù„Ù… ==========

    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµØ© Ø¨Ø§Ù„Ù…Ø¹Ù„Ù… ÙÙŠ Dashboard (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    function generateTeacherReport(teacherCode) {
      const today = new Date().toISOString().split('T')[0];
      const records = [];

      for (let key in localStorage) {
        if (key.startsWith('attendance_')) {
          const record = JSON.parse(localStorage[key]);
          if (record.teacherCode === teacherCode && record.date === today) {
            records.push(record);
          }
        }
      }

      if (records.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„ÙŠÙˆÙ…');
        return;
      }

      // ØªÙˆÙ„ÙŠØ¯ CSV
      let csv = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± - ${teachersDB[teacherCode].name}\n`;
      csv += `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(today).toLocaleDateString('ar-EG')}\n\n`;
      csv += 'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';

      let presentCount = 0;
      let absentCount = 0;

      records.forEach(record => {
        const status = record.status === 'present' ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨';
        if (record.status === 'present') presentCount++;
        else absentCount++;

        csv += `${record.studentName},${status},"${record.notes}"\n`;
      });

      csv += `\nØ§Ù„Ù…Ù„Ø®Øµ:\n`;
      csv += `Ø§Ù„Ø­Ø§Ø¶Ø±ÙˆÙ†: ${presentCount}\n`;
      csv += `Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ†: ${absentCount}\n`;
      csv += `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${records.length}\n`;

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `teacher_report_${teacherCode}_${today}.csv`;
      link.click();

      alert(`ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!\nØ¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${records.length}`);
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ==========

    // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµØ©
    function showTeacherReportsPage() {
      document.getElementById('dashboardPage').style.display = 'none';
      document.getElementById('teacherReportsPage').style.display = 'block';
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙˆØ±Ø©
      document.querySelector('.profile-image-container').style.display = 'none';
      document.getElementById('selectTeacherForReport').addEventListener('change', loadTeacherReportStats);
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù…
    function loadTeacherReportStats() {
      const teacherCode = document.getElementById('selectTeacherForReport').value;

      if (!teacherCode) {
        document.getElementById('teacherStatsContainer').innerHTML = '<p style="text-align: center; color: #999;">Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù…Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>';
        return;
      }

      const records = [];
      for (let key in localStorage) {
        if (key.startsWith('attendance_')) {
          const record = JSON.parse(localStorage[key]);
          if (record.teacherCode === teacherCode) {
            records.push(record);
          }
        }
      }

      let presentCount = 0;
      let absentCount = 0;
      const studentStats = {};

      records.forEach(record => {
        if (record.status === 'present') presentCount++;
        else absentCount++;

        if (!studentStats[record.studentName]) {
          studentStats[record.studentName] = { present: 0, absent: 0 };
        }
        studentStats[record.studentName][record.status === 'present' ? 'present' : 'absent']++;
      });

      // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
      let html = `
        <div class="stats-section">
          <div class="stat-card">
            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
            <div class="stat-value">${records.length}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Ø­Ø§Ø¶Ø±ÙˆÙ†</div>
            <div class="stat-value" style="color: #26ac68;">${presentCount}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ØºØ§Ø¦Ø¨ÙˆÙ†</div>
            <div class="stat-value" style="color: #f44336;">${absentCount}</div>
          </div>
        </div>
      `;

      if (Object.keys(studentStats).length > 0) {
        html += '<h5 style="color: #147a3d; margin-top: 2rem; margin-bottom: 1rem;">ğŸ“š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨:</h5>';
        html += '<div style="overflow-x: auto;">';
        html += '<table style="width: 100%; border-collapse: collapse;">';
        html += '<tr style="background: #f5f5f5;"><th style="padding: 0.75rem; border: 1px solid #ddd; text-align: right;">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th><th style="padding: 0.75rem; border: 1px solid #ddd;">Ø­Ø§Ø¶Ø±</th><th style="padding: 0.75rem; border: 1px solid #ddd;">ØºØ§Ø¦Ø¨</th></tr>';

        for (const [studentName, stats] of Object.entries(studentStats)) {
          html += `<tr><td style="padding: 0.75rem; border: 1px solid #ddd; text-align: right;">${studentName}</td><td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center; color: #26ac68;">${stats.present}</td><td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center; color: #f44336;">${stats.absent}</td></tr>`;
        }

        html += '</table></div>';
      }

      document.getElementById('teacherStatsContainer').innerHTML = html;
    }

    // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…
    function exportDailyTeacherReport() {
      const teacherCode = document.getElementById('selectTeacherForReport').value;

      if (!teacherCode) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ù„Ù…Ø§Ù‹');
        return;
      }

      const today = new Date().toISOString().split('T')[0];
      const records = [];

      for (let key in localStorage) {
        if (key.startsWith('attendance_')) {
          const record = JSON.parse(localStorage[key]);
          if (record.teacherCode === teacherCode && record.date === today) {
            records.push(record);
          }
        }
      }

      if (records.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„ÙŠÙˆÙ…');
        return;
      }

      generateTeacherReport(teacherCode);
    }

    // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…
    function exportWeeklyTeacherReport() {
      const teacherCode = document.getElementById('selectTeacherForReport').value;

      if (!teacherCode) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ù„Ù…Ø§Ù‹');
        return;
      }

      const today = new Date();
      const last7Days = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
      const records = [];

      for (let key in localStorage) {
        if (key.startsWith('attendance_')) {
          const record = JSON.parse(localStorage[key]);
          const recordDate = new Date(record.date);
          if (record.teacherCode === teacherCode && recordDate >= last7Days && recordDate <= today) {
            records.push(record);
          }
        }
      }

      if (records.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ù„Ù… ÙÙŠ Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…');
        return;
      }

      // ØªÙˆÙ„ÙŠØ¯ CSV
      const teacher = teachersDB[teacherCode];
      let csv = `Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ - ${teacher.name}\n`;
      csv += `Ù…Ù† ${last7Days.toLocaleDateString('ar-EG')} Ø¥Ù„Ù‰ ${today.toLocaleDateString('ar-EG')}\n\n`;
      csv += 'Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';

      let presentCount = 0;
      let absentCount = 0;

      records.forEach(record => {
        const status = record.status === 'present' ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§Ø¦Ø¨';
        const dateFormatted = new Date(record.date).toLocaleDateString('ar-EG');
        if (record.status === 'present') presentCount++;
        else absentCount++;

        csv += `${dateFormatted},${record.studentName},${status},"${record.notes}"\n`;
      });

      csv += `\nØ§Ù„Ù…Ù„Ø®Øµ:\n`;
      csv += `Ø§Ù„Ø­Ø§Ø¶Ø±ÙˆÙ†: ${presentCount}\n`;
      csv += `Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ†: ${absentCount}\n`;
      csv += `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${records.length}\n`;

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `weekly_report_${teacherCode}_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();

      alert(`ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­!\nØ¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${records.length}`);
    }
  </script>
</body>
</html>
